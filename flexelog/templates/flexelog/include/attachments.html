{% load flex %}
{% load i18n %}

<table id="attachments_table" class="frame" cellpadding="0" cellspacing="0">
<!-- table width="100%" border="0" cellpadding="0" cellspacing="0" -->
    {# Display existing attachment #}
    {% for attachment_form in attachment_formset %}
    {% if attachment_form.instance.pk %} {# This form represents an existing attachment #}
        <tr><td>
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
            <td nowrap width="10%" class="attribname">{% translate "Attachment" %} {{ forloop.counter }}:</td>
            <td nowrap width="20%" class="attribvalue"><a href="{{ attachment_form.instance.attachment_file.url }}" target="_blank">
                {{ attachment_form.instance.display_filename }}</a>
                &nbsp;<span class="bytes">{{ attachment_form.instanct.attachment_file.size|filesizeformat }}</span>
            </td>

            <td class="attribvalue">
                {% if editing %}
                {{ attachment_form.delete_attachment }}
                <label class="form-check-label" for="{{ attachment_form.delete_attachment.id_for_label }}">{% translate "Delete" %}</label>
                {% endif %}
            </td>
            
            {{ attachment_form.id }} {# Hidden input for instance #}
            {{ attachment_form.attachment_file.as_hidden }} {# existing file path hidden #}
            </tr>   
        </table>
        </td></tr>
    {% endif %}
    {% endfor %}
    
    {% if editing %}
    {% for attachment_form in attachment_formset %}
        {% if not attachment_form.instance.pk %} {# This form represents a new, empty attachment form #}
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
                <td nowrap width="10%" class="attribname">{% translate "New Attachment" %}</td>
                <td nowrap width="20%" class="attribvalue">
                    {# {{ attachment_form.attachment_file.label_tag }} #}
                    {{ attachment_form.attachment_file }}
                    {% if attachment_form.attachment_file.errors %}<div class="text-danger">{{ attachment_form.attachment_file.errors }}</div>{% endif %}
                </td>
                <td class="attribvalue">{{ attachment_form.id.as_hidden }}</td>
            </tr>
        {% endif %}
        </table>
    {% endfor %}
    {% endif %}



    {% comment %}
    <tr><td>
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
            <td nowrap width="10%" class="attribname">{% translate "Attachment" %} {{ forloop.counter }}:</td>
            <td class="attribvalue"><a href="{{ attachment.attachment_file.url }}">{{ attachment.display_filename }}</a>
                &nbsp;<span class="bytes">{{ attachment.attachment_file.size|filesizeformat }}</span></td>
            </tr>   
        </table>
    </td></tr>
    <tr><td>
        <table width="100%" cellpadding="0" cellspacing="0">
            <tr>
            {% if attachment.is_image %}
                <td class="attachmentframe"><img src="{{ attachment.attachment_file.url }}" height="200px" /></td>
            {% else %}
                <td class="messageframe"><object id="frame" data="{{ attachment.attachment_file.url }}"></object></td>
            {% endif %}
            </tr>
        </table>
    </td></tr>

    {% endfor %}


   {% if editing %}
    <tr><td>
        <table width="100%" cellpadding="0" cellspacing="0">
        {% for i in attachment_slots %}
        <tr>
        <td nowrap class="attribname">{% translate "Attachment" %} {{ i }}:</td>
        <td class="attribvalue"><input type="file" size="60" maxlength="200" name="attfile{{i}}"></td>
        </tr>
        {% endfor %}
        </table>
    </td></tr>
   {% endif %}
    
    {% endcomment %}

   </table>
